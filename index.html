<script>
  const apiKey = "AIzaSyAxk1YpQSe-qDtFUSUmnjnduanag41Mlyk";
  const playlistId = "PLsHj_P-wUyYnbIgioZx3iat9EzihpACzw";
  const container = document.getElementById("videos");

  function parseDuration(duration) {
    const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
    const hours = parseInt(match[1]) || 0;
    const minutes = parseInt(match[2]) || 0;
    const seconds = parseInt(match[3]) || 0;
    return hours * 3600 + minutes * 60 + seconds;
  }

  async function fetchAllVideos(pageToken = "", allItems = []) {
    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${apiKey}&pageToken=${pageToken}`;
    const res = await fetch(url);
    const data = await res.json();

    if (data.items) allItems = allItems.concat(data.items);
    if (data.nextPageToken) return fetchAllVideos(data.nextPageToken, allItems);
    return allItems;
  }

  async function getVideoDurations(videoIds) {
    const url = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${videoIds.join(",")}&key=${apiKey}`;
    const res = await fetch(url);
    const data = await res.json();
    return data.items;
  }

  fetchAllVideos().then(async items => {
    container.innerHTML = "";
    if (!items.length) {
      container.innerText = "å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
      return;
    }

    const videoIds = items.map(item => item.snippet.resourceId.videoId);
    const videoDetails = await getVideoDurations(videoIds);

    const durationMap = {};
    videoDetails.forEach(v => {
      durationMap[v.id] = parseDuration(v.contentDetails.duration);
    });

    items.forEach(item => {
      const title = item.snippet.title;
      const videoId = item.snippet.resourceId.videoId;
      const thumbnail = item.snippet.thumbnails.medium.url;

      // ğŸ”¥ 60ç§’ä»¥ä¸‹ã¯é™¤å¤–ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆåˆ¤å®šï¼‰
      if (durationMap[videoId] <= 60) return;

      const div = document.createElement("div");
      div.className = "video-item";
      div.innerHTML = `
        <img src="${thumbnail}" alt="${title}" />
        <p>${title}</p>
      `;

      div.onclick = () => {
        div.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?rel=0" frameborder="0" allowfullscreen loading="lazy"></iframe>`;
      };

      container.appendChild(div);
    });
  }).catch(err => {
    container.innerText = "APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
    console.error(err);
  });
</script>
