<!doctype html>
<meta charset="utf-8">
<title>マキシマム</title>
<style>
  body{font:16px/1.5 system-ui;margin:20px}
  #out{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:16px}
  .card{border:1px solid #ddd;border-radius:8px;overflow:hidden;cursor:pointer}
  .card img{width:100%}
  .card h3{font-size:14px;margin:6px}
</style>

<p>
  キーワード:
  <input value="添い寝ラジオ" readonly>
  新着10件（60秒以下除外）
  <button id="go">検索</button>
</p>

<div id="out"></div>

<script>
const KEY   = "AIzaSyAxk1YpQSe-qDtFUSUmnjnduanag41Mlyk";
const QUERY = "添い寝ラジオ";
const MAX   = 10;

function isoToSec(iso){
  const m = iso.match(/PT(?:(\d+)M)?(?:(\d+)S)?/);
  return (m[1]?+m[1]*60:0) + (m[2]?+m[2]:0);
}

async function run(){
  out.textContent = "読み込み中...";

  // ① search
  const s = await fetch(
    `https://www.googleapis.com/youtube/v3/search?` +
    new URLSearchParams({
      part:"snippet",
      q:QUERY,
      order:"date",
      type:"video",
      maxResults:MAX,
      key:KEY
    })
  ).then(r=>r.json());

  if(!s.items?.length){
    out.textContent = "動画なし";
    return;
  }

  const ids = s.items.map(v=>v.id.videoId).join(",");

  // ② videos（長さ取得）
  const v = await fetch(
    `https://www.googleapis.com/youtube/v3/videos?` +
    new URLSearchParams({
      part:"contentDetails",
      id:ids,
      key:KEY
    })
  ).then(r=>r.json());

  const durationMap = {};
  v.items.forEach(i=>{
    durationMap[i.id] = isoToSec(i.contentDetails.duration);
  });

  // ③ 60秒超だけ表示
  out.innerHTML = "";
  s.items.forEach(item=>{
    const id = item.id.videoId;
    if((durationMap[id] || 0) <= 60) return;

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${item.snippet.thumbnails.medium.url}">
      <h3>${item.snippet.title}</h3>
    `;
    card.onclick = ()=>{
      card.innerHTML = `
        <iframe width="100%" height="200"
          src="https://www.youtube.com/embed/${id}?autoplay=1"
          allow="autoplay" allowfullscreen>
        </iframe>`;
    };
    out.appendChild(card);
  });

  if(!out.children.length){
    out.textContent = "60秒超の動画がありません";
  }
}

document.getElementById("go").onclick = run;
</script>
